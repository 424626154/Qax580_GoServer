{{template "adminheader.html" .}}
<script type="text/javascript" src="/static/jquery/jquery-1.8.3.min.js" charset="UTF-8"></script>
<script type="text/javascript">
$(document).ready(function(){
            initData();
        });
function initData(){
	// alert({{.Guanggao}})
	document.getElementById("title").value = {{.Guanggao.Title}};
	document.getElementById("info").value = {{.Guanggao.Info}};
	document.getElementById("blink").checked = {{.Guanggao.Blink}};
	document.getElementById("link").value = {{.Guanggao.Link}};
}
var img_path = "";
	function onclikBtn(){
		if(img_path == ""){
			alert("请选择图片");
			return;
		}
		var url = "/admin/upguanggao?op=upimg&id="+{{.Guanggao.Id}};
		alert(url)
	   document.getElementById("add").action = url;
	   document.getElementById("add").method = "post";   
	   document.getElementById("add").enctype = "multipart/form-data"
	   document.getElementById("add").submit(); 
	}
	function setImage(obj){  
    var value = obj.value;  
    img_path = value;
 	} 
 	function addGuangao(){
 		var img = {{.Guanggao.Image}};
 		if(img == ""){
			alert("请选择图片");
			return;
		}
		var title = document.getElementById("title").value;
		var info = document.getElementById("info").value;
		if(title == ""){
			alert("请输入标题");
			return;
		}
		if(info == ""){
			alert("请输入内容");
			return;
		}
		var blink = document.getElementById("blink").checked;
		if(blink){
			var link = document.getElementById("link").value;
			if(link == ""){
				alert("请输入链接");
				return;
			}else if(!IsURL(link)){
				alert("请输入有效的地址");
				return;
			}
		}
		var url = "/admin/upguanggao?op=add&img="+img+"&title="+title+"&info="+info+"&blink="+blink+"&link="+link+"&id="+{{.Guanggao.Id}};
		// alert(url)
		document.getElementById("add").action = url;
	   document.getElementById("add").method = "post";   
	   document.getElementById("add").enctype = "multipart/form-data";
	   document.getElementById("add").submit(); 
 	}
 	function IsURL(str_url){
        var strRegex = "^((https|http|ftp|rtsp|mms)?://)"
        + "?(([0-9a-z_!~*'().&=+$%-]+: )?[0-9a-z_!~*'().&=+$%-]+@)?" //ftp的user@
        + "(([0-9]{1,3}\.){3}[0-9]{1,3}" // IP形式的URL- 199.194.52.184
        + "|" // 允许IP和DOMAIN（域名）
        + "([0-9a-z_!~*'()-]+\.)*" // 域名- www.
        + "([0-9a-z][0-9a-z-]{0,61})?[0-9a-z]\." // 二级域名
        + "[a-z]{2,6})" // first level domain- .com or .museum
        + "(:[0-9]{1,4})?" // 端口- :80
        + "((/?)|" // a slash isn't required if there is no file name
        + "(/[0-9a-z_!~*'().;?:@&=+$,%#-]+)+/?)$";
        var re=new RegExp(strRegex);
        //re.test()
        if (re.test(str_url)){
            return (true);
        }else{
            return (false);
        }
	}
</script>
<form id = "add" name="add" class="form-inline" method="post" action="/admin/upguanggao" enctype="multipart/form-data">
  <div class="form-group">
    <label for="">标题</label>
    <input type="text" class="form-control" id="title" name="title" placeholder="输入标题">
  </div>
  <div class="form-group">
    <label for="">内容</label>
    <textarea class="form-control" rows="10" placeholder="输入内容" id="info" name="info"></textarea>
  </div>
  <div class="checkbox">
    <label>
      <input type="checkbox" name="blink" id="blink">添加链接
    </label>
    <input type="text" class="form-control" id="link" name="link" placeholder="输入链接地址">
  </div>
  <button type="button" class="my_button my_gray" onclick="addGuangao();">修改</button>
    <div>
  		{{if eq .Guanggao.Image ""}}
  		{{else}}
  		<img src="http://182.92.167.29:8080/imagehosting/{{.Guanggao.Image}}" alt="http://182.92.167.29:8080/imagehosting/{{.Guanggao.Image}}" width="auto" height="100px">
  		<!-- <img src="http://127.0.0.1:8080/imagehosting/{{.Guanggao.Image}}" alt="http://182.92.167.29:8080/imagehosting/{{.Guanggao.Image}}" width="auto" height="100px"> -->
  		{{end}}
	  <div class="form-group">
          <label>选择图片：尺寸为 450*250</label>
          <input type="file" class="form-control" name="image" id="image" accept="image/*" onchange="setImage(this)">
                 <button type="button" class="my_button my_gray" onclick="onclikBtn();">修改图片</button>
       </div>
	</div>
</form>
{{template "footer.html" .}}